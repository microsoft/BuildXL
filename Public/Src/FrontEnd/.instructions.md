# FrontEnd Component

The FrontEnd component implements BuildXL's pluggable build specification frontends. Each frontend translates a build language (DScript, MSBuild, JavaScript, Ninja) into the unified pip graph. Multiple frontends can be mixed in a single build via resolvers configured in `config.dsc`.

## Architecture

### Frontend Responsibilities
1. Provide a list of modules and exported values from resolver settings
2. Evaluate public values and construct pips for the pip graph

### Supported Frontends

| Frontend | Kind | Use Case |
|----------|------|----------|
| DScript | `"DScript"` | Native BuildXL specs (most strict, fully declarative) |
| JavaScript | `"Rush"`, `"Yarn"`, `"Lage"`, `"Nx"` | Node.js monorepo builds |
| MSBuild | `"MsBuild"` | Visual Studio / .NET projects |
| Ninja | `"Ninja"` | CMake and native C++ builds |
| NuGet | `"Nuget"` | NuGet package resolution |
| Download | `"Download"` | File downloads with hash verification |

### Resolver Configuration
```typescript
config({
    resolvers: [
        { kind: "DScript", modules: [...globR(d`Sdk`, "module.config.bm")] },
        { kind: "Nuget", repositories: {"nuget": "https://api.nuget.org/v3/index.json"},
          packages: [{id: "System.Runtime", version: "4.3.0"}] },
        { kind: "Rush", moduleName: "my-rush-repo", root: d`src/js` }
    ]
});
```

## Module Structure

| Directory | Purpose |
|-----------|---------|
| `Core/` | Core frontend abstractions, interfaces, and base classes |
| `Script/` | DScript evaluation engine |
| `TypeScript.Net/` | TypeScript language bindings for DScript |
| `JavaScript/` | Shared JavaScript/Node.js frontend logic |
| `Rush/` | Rush monorepo coordinator |
| `Yarn/` | Yarn workspace coordinator |
| `Lage/` | Lage task runner coordinator |
| `Nx/` | Nx monorepo coordinator |
| `MsBuild/` | MSBuild frontend implementation |
| `MsBuild.Serialization/` | MSBuild graph serialization |
| `Ninja/` | Ninja frontend for CMake builds |
| `Ninja.Serialization/` | Ninja graph serialization |
| `Nuget/` | NuGet package resolver |
| `Download/` | File download resolver |
| `Factory/` | Frontend factory and instantiation |
| `Sdk/` | SDK utilities and helpers |
| `SdkProjectGraph/` | Project graph abstractions shared across frontends |
| `SdkTesting/` | Testing utilities for SDK authors |
| `Utilities/` | Common frontend utilities |
| `UnitTests/` | Frontend unit tests |

## DScript Language Reference

### Key Differences from TypeScript
- No `void` functions (all functions must return a value)
- Immutable by default (`const`); `let` exists but reassignment is rare
- No classes — use interfaces with structural typing
- No `null` or `undefined`
- Path literals are first-class types (`File`, `Directory`, `Path`)
- Pure functions: side-effect free, memoizable, cacheable

### Path Literals
```typescript
f`path/to/file.cs`     // File reference
d`path/to/dir`         // Directory reference
p`path/to/output`      // Output path (promise)
a`name`                // Path atom (filename/folder name)
r`relative/path`       // Relative path
```

### Import / Export
```typescript
import * as Mod from "ModuleName";          // Full module import
import {Result} from "ModuleName";          // Named import
const x = importFrom("ModuleName").value;   // Inline import expression

@@public
export const myLib = ...;                    // Public export (cross-module visible)
export {X} from "ModuleName";               // Re-export
```

### Functions
```typescript
// Preferred: single interface parameter for extensibility
function compile(args: CompileArgs): CompileResult {
    // ...
}

// All functions must return a value (no void)
// Pure functions: no side effects, no I/O
```

### Globbing
```typescript
glob(d`src`, "*.cs")           // Non-recursive glob in src/
globR(d`.`, "*.cs")            // Recursive glob from current dir
globRecursively(d`.`, "*.cs")  // Same as globR
globFolders(d`src`)            // List subdirectories
```

### Types
- **Interfaces** (PascalCase): primary structuring mechanism
- **Union types**: `"debug" | "release"`
- **Intersection types**: `A & B`
- **Generics**: TypeScript-compatible syntax
- **Enums**: const enums only, or prefer string literal types
- **`StaticDirectory`**: Sealed directory type for passing file sets between pips

### Templates
```typescript
// Declaration (in namespace or module root)
export declare const template: SDKTemplate = { optimize: false };

// Consumption
const settings = Context.getTemplate<SDKTemplate>();
```

Templates merge hierarchically through namespaces — child templates override parent values.

### Evaluation Semantics
- Global declarations evaluate in parallel with blocking on dependencies
- Each declaration's RHS is evaluated exactly once (memoization)
- Functions execute top-down sequentially
- Import dependencies create implicit evaluation ordering

## JavaScript Frontend Details

### Supported Coordinators
Rush, Yarn, Lage, Nx — auto-detected from monorepo config. Minimal configuration:
```typescript
{ kind: "Rush", moduleName: "my-repo", root: d`src/js` }
```

### Key Considerations
- Translates JS project scripts into BuildXL pips
- Supports hybrid builds (JS + DScript in same build)
- Common issues: missing project-to-project dependencies, undeclared file accesses
- Weak fingerprint augmentation enabled by default for JS resolvers

## Ninja Frontend Details

Supports CMake projects and plain Ninja builds:
```typescript
{ kind: "Ninja", moduleName: "native-build", root: d`src/native`, specFile: f`build.ninja` }
```

Default spec file: `build.ninja`. Enforces BuildXL sandboxing for safe caching.

## Download Frontend Details

File downloads with hash verification:
```typescript
{
    kind: "Download",
    downloads: [{
        moduleName: "my-tool",
        url: "https://example.com/tool.zip",
        hash: "VSO0:abc123...",
        archiveType: "zip"
    }]
}
```

Exposed as module with `.file` (File) and `.extracted` (StaticDirectory) fields.

## Testing

```bash
# Build all frontend tests
bxl Public\Src\FrontEnd\UnitTests\...

# Target specific frontend tests (e.g., JavaScript)
bxl Test.BuildXL.FrontEnd.Script.dsc -TestClass TestClassName
```

## Common Pitfalls
- **DScript immutability**: `.push()` returns a new array, doesn't mutate — `const newArr = arr.push(item)`
- **No void functions**: Every function must return a value; use interface return types
- **Glob performance**: `globR` on large trees is expensive — scope to specific subdirectories
- **Module naming**: Must be globally unique; follow `Company.Product.Component` convention
- **JS undeclared accesses**: JavaScript tools often access files not declared in package.json — use `allowUndeclaredSourceReads` or declare explicitly
- **Frontend mixing**: When mixing DScript + JS resolvers, ensure module names don't collide
